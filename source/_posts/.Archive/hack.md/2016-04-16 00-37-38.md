title: hack一下学校的选课系统吧~
date: 2016-04-15 22:17:03
categories:
- 编程
tags:
- JavaScript
- http
- node
---


# hack了一下学校的选课系统
并没写过科技文档，最近为了做选课系统所以研究了一下学校的选课系统用的各种方法
<!-- more -->
## 学校选课系统登陆状态的保存
直接用chrome抓包，发现所有的网页请求都附上了cookies，而且清楚cookies正常提示要我登录，所以应该是从cookies入手。

学校的系统用的是不知道几年前的清华大学的选课系统，先抓一下登录页面
[清华大学选课系统](http://jwxt.sdu.edu.cn:7890/zhxt_bks/xk_login.html)（其实因为是乱码的原因，我也不知道这个网页的标题到底是什么。。）

![](http://ww4.sinaimg.cn/large/bd69bf14jw1f2xslwk2efj20i00j3go7.jpg)
（新浪图床）
`request`中的`form Data`被我打码的是我的学号和密码。而`request URL`看起来非常的奇怪，抓了几个包发现都不是同样的网址，也找不到规律，所以回到网页看查看表单的html源码。

```html
    <form action="/pls/wwwbks/bks_login2.login" method="POST" onsubmit="addJYM(this,2)">
```
可以看到，表单的`onsubmit`事件上绑定了一个`addJYM()`函数，在继续寻找`addJYM()`的所在位置，在整个网页唯一一个`<script>`标签处找到

```
<script language="JavaScript1.2" src="nocache.js"></script>
```

[nocache.js](http://jwxt.sdu.edu.cn:7890/zhxt_bks/nocache.js)
（我chrome打开是乱码状态，在本地用文本编辑器以gbk编码打开即可）
直接查看源码之后可以发现，在这里生成了一个随机数，然后做为url参数中`jym2005`的值，然后做为post的地址。所以在进行post请求的时候直接在复制代码生成一个随机数即可。

## 现在观察一下`response`
`response`中的`set-cookies`直接观察结构能看出来是`学号+时间`的格式，（明文传输，给我省劲了不少）
所以直接使用` npm`上`request`包，传输帐号密码后直接获取`response`中的`cookies`，在进行其他请求的时候附上即可。

## 写了个轮子

```javascript
var request = require('request');

var url = 'http://jwxt.sdu.edu.cn:7890/pls/wwwbks/bks_login2.login';
var forms = {
  form: {
    stuid: '你的学号',
    pwd: '你的密码'
  }
};
var request = request.defaults({ jar: true })
request.post(addJYM(url), forms, function (err, response, body) {
  if (!err) {
    request('http://jwxt.sdu.edu.cn:7890/pls/wwwbks/xk.CourseView', function (ree, response, body) {
      console.log(body)
    })

  } else {
    console.log(err);
  }
});

function addJYM(url) {
  var time = ((new Date().getTime() * 9301 + 49297) % 233280) / (233280.0);
  var rand = Math.random();
  time = (time + rand) * 9301;
  url = url + '?jym2005=' + time;
  return url;
}

```
运行后在控制台即可显示出你的密码


运行环境：ndoe.js v5.10.1
  "dependencies": {
    "request": "^2.71.0"
  }
}

